<% flashed_errors(:recipe) %>

<div class="control-group">
  <%= form.label t("recipe.name"), :class => "control-label" %>
  <div class="controls">
    <%= form.text_field :name, :class => "text_field" %>
  </div>
</div>

<div class="control-group">
  <%= form.label t("recipe.description"), :class => "control-label" %>
  <div class="controls">
    <%= form.text_area :description, :class => "text_field", :style => "width:663px; height: 100px;"%>
  </div>
</div>

<div class="control-group">
  <%= form.label t("recipe.body"), :class => "control-label" %>
  <div class="controls">
    <%= form.text_area :body, :id => "recipe_body", :class => "text_field", :style => "width:663px; height: 100px;"%>
  </div>
</div>

<div id="preview_fieldset">
  <fieldset class="fieldset">
    <legend><%= t("recipe.code_preview") %></legend>
    <div id="preview">
      <%= render partial: 'preview', locals: { recipe: @recipe } %>
    </div>
  </fieldset>
  <br/>
</div>

<% content_for(:page_scripts) do %>
<%= javascript_tag do %>
$(document).on('page:change', function() {
  $('#recipe_body').change(function () {
    $.ajax({
      type: 'GET',
      url: "<%= preview_recipes_url %>",
      cache: false,
      data: {
        body: $('#recipe_body').val()
      },
      dataType: 'html',
      success: function (data) {
        $('#preview').html(data);
      },
      error: function (req, status, error) {
        alert("ERROR:" + error.toString() + " " + status + " " + req.responseText);
      }
    });
  });
});
<% end %>
<% end %>
